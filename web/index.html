<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- PWA / App-like -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#0b1220" />

    <!-- ✅ PWA manifest -->
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- iOS standalone -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ShpunApp" />

    <!-- Icons -->
    <link rel="icon" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />

    <meta name="format-detection" content="telephone=no" />

    <title>ShpunApp</title>

    <!-- ✅ Crash overlay (без DevTools): покажет runtime-ошибки прямо поверх экрана -->
    <script>
      (function () {
        function mountBox(text) {
          try {
            var el = document.getElementById("__shpun_crash__");
            if (!el) {
              el = document.createElement("div");
              el.id = "__shpun_crash__";
              el.style.cssText =
                "position:fixed;left:12px;right:12px;bottom:12px;z-index:999999;" +
                "padding:12px;border-radius:14px;background:rgba(0,0,0,.72);" +
                "border:1px solid rgba(255,255,255,.22);color:#fff;" +
                "font:12px/1.4 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;" +
                "white-space:pre-wrap;word-break:break-word";
              document.addEventListener("DOMContentLoaded", function () {
                document.body && document.body.appendChild(el);
              });
              if (document.body) document.body.appendChild(el);
            }
            el.textContent = text;
          } catch {}
        }

        function show(msg) {
          mountBox("⚠️ ShpunApp error:\n" + String(msg));
        }

        window.addEventListener("error", function (e) {
          var m = (e && (e.message || (e.error && e.error.stack) || e.error)) || e;
          show(m);
        });

        window.addEventListener("unhandledrejection", function (e) {
          var r = e && e.reason;
          var m = (r && (r.stack || r.message)) || r || e;
          show(m);
        });

        setTimeout(function () {
          var root = document.getElementById("root");
          if (root && root.childNodes.length === 0) {
            show(
              "React не смонтировался.\n" +
                "Проверь: загрузку /assets/index-*.js и runtime-ошибки выше.\n" +
                "Если видишь пустой экран в Telegram — обычно виноват Service Worker кэш."
            );
          }
        }, 2500);
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
